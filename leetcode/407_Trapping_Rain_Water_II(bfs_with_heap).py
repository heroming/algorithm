#!/usr/bin/python
# -*- coding: utf-8 -*-

class ListNode(object):
    def __init__(self, x):
        self.val = x
        self.next = None
    
    def show(self) :
        print self.val, 
        if self.next is not None :
            self.next.show()
        else :
            print

class TreeNode(object):
    def __init__(self, x):
        self.val = x
        self.left = None
        self.right = None
        
class TreeLinkNode(object):
    def __init__(self, x):
        self.val = x
        self.left = None
        self.right = None
        self.next = None

class UndirectedGraphNode(object):
    def __init__(self, x):
        self.label = x
        self.neighbors = []
        
class DirectedGraphNode(object):
    def __init__(self, x):
        self.label = x
        self.neighbors = []

class SegmentTreeNode:
    def __init__(self, start, end):
        self.start, self.end = start, end
        self.left, self.right = None, None

class TreeOrder(object):
    def preorder(self, root) :
        ans = []
        self.dfs(root, ans, 0)
        print ans
        
    def inorder(self, root) :
        ans = []
        self.dfs(root, ans, 1)
        print ans
        
    def postorder(self, root) :
        ans = []
        self.dfs(root, ans, 2)
        print ans
        
    def dfs(self, root, ans, flag) :
        if root == None : return
        if (flag == 0) : ans.append(root.val)
        self.dfs(root.left, ans, flag)
        if (flag == 1) : ans.append(root.val)
        self.dfs(root.right, ans, flag)
        if (flag == 2) : ans.append(root.val)
        
class Point(object):
    def __init__(self, a = 0, b = 0):
        self.x = a
        self.y = b
        
class Bit(object) :
    def __init__(self, n) :
        self.n = n
        self.data = [0 for _ in xrange(n + 1)]
        
    def lowbit(self, x) :
        return x & -x
    
    def update(self, k, w) :
        while k <= self.n :
            self.data[k] += w
            k += self.lowbit(k)
            
    def query(self, k) :
        ans = 0
        k = min(k, self.n)
        while k > 0 :
            ans += self.data[k]
            k -= self.lowbit(k)
        return ans
    
class Trie :
    
    N, X = 26, ord('a')
    
    def __init__(self) :
        self.count = 0
        self.word = None
        self.data = [None for i in xrange(Trie.N)]
        
    def insert_dfs(self, k, s) :
        
        self.count += 1
        if k == len(s) :
            self.word = s
            return
        
        idx = ord(s[k]) - Trie.X
        if self.data[idx] is None :
            self.data[idx] = Trie()
            
        self.data[idx].insert_dfs(k + 1, s)
        
    def delete_dfs(self, k, s) :
        
        self.count -= 1
        if k == len(s) :
            self.word = None
            return
        
        idx = ord(s[k]) - Trie.X
        if self.data[idx] :
            self.data[idx].delete_dfs(k + 1, s)
    
    def insert(self, s) :
        self.insert_dfs(0, s)
        
    def delete(self, s) :
        self.delete_dfs(0, s)
        
    def exist(self, idx) :
        return self.data[idx] is not None
    
    def get(self, idx) :
        return self.data[idx]
    
    def isWord(self) :
        return self.word is not None
            
class MaxHeap :
    def __init__(self) :
        self.data = []
        
    def size(self) :
        return len(self.data)
    
    def empty(self) :
        return self.size() == 0
    
    def top(self) :
        return None if self.empty() else self.data[0]
 
    def push(self, x) :
        k = self.size()
        self.data.append(x)
        while k > 0 :
            p = (k - 1) >> 1
            if self.data[k] <= self.data[p] : break
            self.data[k], self.data[p] = self.data[p], self.data[k]
            k = p
    
    def pop(self) :
        if self.empty() : return None
        x = self.data[0]
        self.data[0], self.data[-1] = self.data[-1], self.data[0]
        self.data.pop()
        k, n = 0, self.size()
        while k < n :
            idx = k
            l, r = (k << 1) | 1, (k + 1) << 1
            if l < n and self.data[idx] < self.data[l] : idx = l
            if r < n and self.data[idx] < self.data[r] : idx = r
            if idx == k : break
            self.data[idx], self.data[k] = self.data[k], self.data[idx]
            k = idx
        return x
                
class MinHeap :
    def __init__(self) :
        self.data = []
        
    def size(self) :
        return len(self.data)
    
    def empty(self) :
        return self.size() == 0
    
    def top(self) :
        return None if self.empty() else self.data[0]
 
    def push(self, x) :
        k = self.size()
        self.data.append(x)
        while k > 0 :
            p = (k - 1) >> 1
            if self.data[p] <= self.data[k] : break
            self.data[k], self.data[p] = self.data[p], self.data[k]
            k = p
    
    def pop(self) :
        if self.empty() : return None
        x = self.data[0]
        self.data[0], self.data[-1] = self.data[-1], self.data[0]
        self.data.pop()
        k, n = 0, self.size()
        while k < n :
            idx = k
            l, r = (k << 1) | 1, (k + 1) << 1
            if l < n and self.data[l] < self.data[idx] : idx = l
            if r < n and self.data[r] < self.data[idx] : idx = r
            if idx == k : break
            self.data[idx], self.data[k] = self.data[k], self.data[idx]
            k = idx
        return x

class TrieNode :
    N, X = 26, ord('a')
    
    def __init__(self) :
        self.count = 0
        self.word = False
        self.data = [None for i in xrange(TrieNode.N)]

class TrieTree :
    def __init__(self) :
        self.root = TrieNode()

    # @param {string} word
    # @return {void}
    # Inserts a word into the trie.
    def insert(self, word) :
        
        def dfs(node, k) :
            if k == len(word) :
                node.word = True
                return
            idx = ord(word[k]) - TrieNode.X
            if not node.data[idx] :
                node.data[idx] = TrieNode()
            node.data[idx].count += 1
            dfs(node.data[idx], k + 1)
 
        if not word : return
        dfs(self.root, 0)
        

    # @param {string} word
    # @return {boolean}
    # Returns if the word is in the trie.
    def search(self, word) :
 
        def dfs(node, k) :
            if k == len(word) :
                return node.word
            if word[k] == '.' :
                for no in node.data :
                    if no is not None and dfs(no, k + 1) :
                        return True
                return False
            else :
                idx = ord(word[k]) - TrieNode.X
                if not node.data[idx] :
                    return False
                return dfs(node.data[idx], k + 1)
        
        if not word : return True
        return dfs(self.root, 0)

    # @param {string} prefix
    # @return {boolean}
    # Returns if there is any word in the trie
    # that starts with the given prefix.
    def startsWith(self, prefix) :
 
        def dfs(node, k) :
            if k == len(prefix) :
                return node.count > 0
            idx = ord(prefix[k]) - TrieNode.X
            if not node.data[idx] :
                return False
            return dfs(node.data[idx], k + 1)
 
        if not prefix : return True
        return dfs(self.root, 0)


class SegmentTree :
    
    def __init__(self, v, s = "MIN") :
        self.n = len(v)
        self.status = s
        self.data = [0 for i in xrange(self.n << 2)]
        self.build(1, 1, self.n, v)
        
    def build(self, x, s, e, v) :
        if s == e :
            if self.status == "MIN" or self.status == "MAX" or self.status == "SUM" :
                self.data[x] = v[s - 1]
            return
        m = (s + e) >> 1
        self.build(x << 1, s, m, v)
        self.build(x << 1 | 1, m + 1, e, v)
        if self.status == "MIN" :
            self.data[x] = min(self.data[x << 1], self.data[x << 1 | 1])
        elif self.status == "MAX" :
            self.data[x] = max(self.data[x << 1], self.data[x << 1 | 1])
        elif self.status == "SUM" :
            self.data[x] = self.data[x << 1] + self.data[x << 1 | 1]
        
    def query(self, l, r) :
        l, r = max(1, l), min(self.n, r)
        if r < l : return None
        return self.query_dfs(1, 1, self.n, l, r)
    
    def query_dfs(self, x, l, r, s, e) :
        if s <= l and r <= e :
            return self.data[x]
        m = (l + r) >> 1
        if e <= m : return self.query_dfs(x << 1, l, m, s, e)
        if m < s : return self.query_dfs(x << 1 | 1, m + 1, r, s, e)
        a = self.query_dfs(x << 1, l, m, s, e)
        b = self.query_dfs(x << 1 | 1, m + 1, r, s, e)
        if self.status == "MIN" :
            return min(a, b)
        elif self.status == "MAX" :
            return max(a, b)
        elif self.status == "SUM" :
            return a + b
 

import heapq
class Solution(object) :
    def trapRainWater(self, mat):
        if not mat or not mat[0] : return 0
        dx = [-1, 0, 1, 0]
        dy = [0, 1, 0, -1]
        n, m = len(mat), len(mat[0])
        dis = [[0 for i in xrange(m)] for j in xrange(n)]
        que = []
        for i in xrange(n) :
            dis[i][0] = mat[i][0]
            heapq.heappush(que, (mat[i][0], i, 0))
            dis[i][m - 1] = mat[i][m - 1]
            heapq.heappush(que, (mat[i][m - 1], i, m - 1))
        for i in xrange(1, m - 1) :
            dis[0][i] = mat[0][i]
            heapq.heappush(que, (mat[0][i], 0, i))
            dis[n - 1][i] = mat[n - 1][i]
            heapq.heappush(que, (mat[n - 1][i], n - 1, i))
        while que :
            (w, x, y) = heapq.heappop(que)
            for i in xrange(len(dx)) :
                a = x + dx[i]
                b = y + dy[i]
                if a >= 0 and a < n and b >= 0 and b < m and dis[a][b] == 0 :
                    dis[a][b] = max(mat[a][b], dis[x][y])
                    heapq.heappush(que, (dis[a][b], a, b))
        ans = 0
        for i in xrange(n) :
            for j in xrange(m) :
                ans += dis[i][j] - mat[i][j]
        return ans

if __name__ == "__main__" :
    so = Solution()
    print so.trapRainWater([[1,4,3,1,3,2],[3,2,1,3,2,4],[2,3,3,2,3,1]])
    print so.trapRainWater([[5,5,5,5,5,5,5],[5,1,1,1,1,1,5],[5,1,5,20,5,1,5],[5,1,20,1,20,1,5],[5,1,5,20,5,1,5],[5,1,1,1,1,1,5],[5,5,5,5,5,5,5]])
    print so.trapRainWater([[1103,1108,1101,1101,1106,1104,1109,1102,1107,1106,1105,1102,1101,1105,1104,1100,1102,1104,1107,1104,1102,1106,1103,1109,1100,1106,1103,1109,1106,1108,1107,1109,1106,1108,1100,1104,1102,1100,1108,1101,1108,1105,1104,1109,1100,1100,1102,1103,1106,1109],[1109,941,67,112,770,869,581,585,98,367,783,955,48,411,196,541,665,540,423,683,572,601,89,208,573,169,800,315,592,676,326,994,607,383,96,720,594,19,295,683,728,421,980,767,822,518,298,478,49,711],[1103,963,654,934,161,569,94,303,874,28,969,542,12,919,267,451,629,852,812,266,525,531,677,847,640,842,356,928,662,395,981,155,700,977,80,851,537,516,496,753,886,455,286,889,716,895,682,687,737,484],[1106,604,357,963,442,987,147,140,257,799,525,580,297,215,548,719,408,427,225,894,522,101,691,150,332,750,36,356,427,115,831,65,710,178,19,494,508,508,624,755,298,491,326,937,48,216,646,798,985,213],[1104,497,656,67,638,979,807,664,677,577,121,498,632,821,19,993,657,517,492,623,614,132,104,930,411,494,488,47,282,463,602,306,951,248,364,931,569,161,937,237,80,48,77,703,212,438,38,859,945,520],[1105,902,994,919,174,395,756,653,784,28,458,376,325,751,967,31,672,878,534,951,105,605,990,525,650,192,953,678,393,241,541,208,133,877,470,649,263,216,292,37,234,741,756,901,834,713,274,497,933,799],[1108,381,746,770,896,386,952,191,406,688,774,289,886,249,157,346,889,762,904,171,141,129,254,887,372,79,942,637,918,866,778,698,237,514,459,475,242,753,656,990,783,421,270,660,660,769,348,539,521,243],[1103,1004,714,649,234,428,70,166,407,978,374,175,19,953,679,468,770,911,563,769,244,337,532,856,339,534,615,29,64,478,614,459,472,670,450,696,89,511,205,486,479,921,652,840,217,673,650,977,927,204],[1108,161,883,610,1007,212,135,612,583,541,432,188,990,246,848,430,933,927,931,480,756,753,743,750,935,950,413,576,270,330,122,348,833,995,949,830,549,426,784,122,957,206,300,937,795,491,709,70,760,983],[1100,506,78,625,246,1003,566,1002,921,178,674,33,868,498,18,159,318,909,575,445,374,522,993,664,801,778,497,853,838,248,826,720,744,246,336,333,591,244,325,503,412,989,526,270,477,887,772,138,786,337],[1103,150,850,908,157,641,677,644,484,505,234,652,568,969,240,894,644,822,128,959,667,882,290,183,494,110,412,256,590,541,584,505,33,776,403,532,407,70,167,234,918,391,228,476,702,459,712,336,623,182],[1107,280,54,270,805,538,370,560,137,950,91,63,797,114,829,190,637,578,603,146,154,863,879,373,681,924,174,383,602,139,555,230,761,951,490,908,831,202,458,958,494,539,11,281,996,182,813,975,751,406],[1103,895,259,684,610,282,598,774,655,191,903,552,763,1006,493,595,905,667,787,353,615,271,235,969,894,573,141,697,538,234,446,343,120,47,17,720,320,606,837,317,139,82,212,244,79,47,829,974,704,958],[1107,662,571,542,621,455,105,104,494,985,329,930,318,439,968,678,501,630,274,328,937,755,401,139,989,822,177,160,786,871,108,93,875,669,978,486,114,425,933,950,753,252,871,413,33,829,81,876,449,697],[1105,728,442,938,858,773,750,377,923,878,590,373,313,456,32,281,284,488,49,207,429,792,449,642,547,824,461,619,691,252,306,228,322,91,508,522,854,600,889,120,468,822,835,123,620,858,395,894,688,786],[1102,459,920,883,91,457,50,894,66,83,488,363,301,801,796,151,313,992,741,545,454,551,357,280,664,967,480,401,203,158,529,285,608,439,511,689,887,903,926,295,976,404,1000,267,195,786,760,499,769,843],[1106,213,736,733,483,742,42,953,134,235,454,653,863,404,435,716,435,664,609,351,949,575,746,940,184,931,68,934,772,179,119,148,383,845,223,208,577,255,504,53,833,300,697,38,694,474,744,119,128,695],[1101,67,612,197,349,786,470,408,62,233,929,171,371,302,358,585,853,925,182,699,969,357,989,1008,385,25,472,471,134,942,156,937,999,758,476,691,886,937,441,290,160,360,803,873,1005,151,800,200,419,325],[1109,378,672,220,728,400,235,190,861,711,122,1008,991,463,108,457,496,337,384,927,617,886,630,411,102,625,904,892,815,313,559,46,33,222,608,751,612,185,283,815,238,747,813,219,201,264,667,687,591,393],[1107,550,270,577,303,362,544,550,596,701,853,146,737,877,710,335,970,664,862,244,469,90,981,625,300,524,231,309,554,164,692,501,704,952,420,350,656,954,890,595,645,85,83,724,952,783,401,265,437,253],[1109,248,333,470,863,975,337,436,274,881,590,957,372,285,251,782,977,250,78,857,835,713,932,908,779,227,33,170,482,812,765,323,50,88,135,256,406,462,682,670,333,263,617,47,890,211,171,857,451,239],[1106,276,294,330,526,63,899,549,575,723,351,330,36,391,761,514,989,157,966,662,817,642,267,777,679,499,978,841,346,419,70,744,37,707,64,553,760,954,92,678,667,433,998,46,166,101,550,146,248,506],[1100,408,138,407,175,160,248,143,991,936,904,403,670,931,100,76,474,203,20,908,871,30,331,211,418,839,303,958,975,541,806,467,939,287,216,456,437,454,941,770,380,835,163,40,108,254,459,924,799,821],[1102,660,841,495,213,249,325,506,549,642,390,346,452,671,623,658,118,402,103,401,162,825,227,315,208,677,911,657,944,700,468,756,702,652,594,906,243,261,754,783,245,134,119,687,796,84,336,256,476,781],[1109,628,596,568,933,146,236,187,793,170,877,604,268,922,246,852,818,479,455,562,252,691,39,713,368,177,787,46,775,605,817,764,223,756,323,499,892,549,676,28,61,895,622,319,159,210,514,967,679,959],[1102,274,640,901,329,351,420,459,387,185,54,547,939,620,645,252,109,879,143,127,897,194,364,861,856,514,61,360,823,83,661,685,347,644,928,666,985,338,115,714,513,512,251,795,122,886,37,221,108,523],[1100,995,707,396,199,905,900,250,255,66,323,907,93,12,541,12,669,868,692,126,572,548,628,814,333,740,42,712,303,492,225,335,478,275,74,667,170,316,259,416,372,925,665,456,927,548,810,586,406,492],[1105,320,30,25,476,353,108,861,56,753,343,271,431,811,888,495,820,49,801,422,807,164,337,462,610,254,352,410,183,100,244,580,410,265,595,877,960,693,728,1006,789,61,620,210,215,498,695,377,889,486],[1109,686,992,468,138,944,713,832,696,238,922,931,808,323,186,745,190,488,781,908,485,560,311,447,760,516,287,797,236,167,625,15,843,608,826,324,542,529,146,229,109,59,502,259,372,30,994,904,508,765],[1104,335,667,455,772,417,314,402,556,540,559,172,897,744,770,713,58,654,584,547,225,683,948,717,932,662,737,269,556,236,24,52,561,34,497,676,793,153,68,340,683,969,502,923,703,614,626,104,258,201],[1101,826,226,579,533,501,583,613,760,129,191,126,523,94,150,10,760,934,506,170,264,531,129,108,444,175,712,61,269,312,604,252,128,820,173,1004,663,746,607,413,217,788,530,730,872,22,82,975,946,578],[1105,552,452,607,650,886,772,704,289,383,1007,235,977,477,398,140,471,51,228,420,455,435,550,327,507,413,339,579,730,276,500,207,818,942,156,811,170,270,505,450,643,854,27,610,322,415,92,135,457,310],[1106,254,87,86,571,584,841,900,154,913,518,996,111,679,928,609,480,88,870,975,880,855,820,898,456,132,655,890,609,102,191,497,698,620,926,259,195,757,502,691,13,362,677,466,31,947,65,501,25,925],[1107,248,771,277,488,569,751,133,449,702,578,982,190,266,945,106,868,130,205,712,811,208,64,830,664,86,767,72,577,782,987,386,372,100,1005,850,11,98,326,803,791,894,775,971,502,710,67,712,182,614],[1104,335,813,469,155,819,897,912,881,464,37,211,193,751,653,188,592,655,277,260,448,58,144,565,371,988,618,780,691,790,384,447,116,539,906,613,349,145,868,572,600,895,125,135,636,769,313,570,414,932],[1100,852,980,306,407,693,637,15,463,318,148,838,755,606,719,1004,209,58,139,67,973,81,304,88,206,283,199,862,843,603,784,1006,797,107,654,547,790,281,904,244,589,42,424,687,638,133,33,190,534,514],[1109,497,586,894,927,134,167,117,986,352,62,113,700,850,210,345,387,990,616,281,576,548,666,990,577,646,466,600,178,990,104,768,829,32,1004,98,157,513,205,485,207,610,588,898,802,140,233,179,473,191],[1102,39,729,810,20,296,799,476,238,967,808,333,725,627,707,71,715,206,574,263,682,772,215,612,660,1007,95,235,528,558,416,672,587,488,473,949,126,262,767,355,571,565,30,287,534,727,700,592,924,265],[1107,948,27,402,902,29,751,987,606,269,535,12,283,465,842,746,404,959,350,514,304,912,69,324,541,946,393,231,880,307,838,67,597,207,811,490,578,904,467,174,163,345,529,436,800,361,525,546,662,217],[1100,956,471,462,622,354,398,1006,928,620,655,756,29,243,306,830,75,874,76,532,39,229,219,558,1007,361,261,874,898,914,82,938,212,895,742,825,240,482,173,158,92,170,256,111,755,552,283,820,417,349],[1105,446,920,904,346,270,256,949,134,496,853,558,776,408,444,509,223,26,981,738,174,416,898,420,517,644,315,143,454,722,482,491,510,745,386,198,1005,984,137,481,470,333,30,236,83,816,735,296,832,59],[1106,348,465,616,110,324,602,415,457,399,479,282,880,331,17,256,519,364,230,999,835,42,674,207,269,747,365,994,385,539,43,103,877,850,709,330,165,302,735,612,43,557,236,913,878,243,512,740,949,84],[1109,127,117,745,324,376,482,32,712,209,561,98,302,781,938,1001,101,445,645,178,48,678,725,274,582,946,860,436,676,151,510,747,268,617,482,935,335,954,957,38,153,860,126,445,631,406,788,722,842,424],[1101,232,444,958,848,368,894,50,794,912,192,295,649,802,254,121,727,580,417,26,608,912,877,76,699,850,824,478,563,656,244,796,230,678,96,69,37,333,461,173,235,643,458,875,436,703,986,505,273,394],[1104,223,648,741,289,338,581,455,806,486,454,40,624,674,60,63,85,439,386,537,603,963,522,403,828,300,96,157,796,711,893,660,924,531,743,555,859,666,353,655,495,797,37,461,461,440,514,889,221,242],[1108,814,196,280,560,14,571,646,513,709,700,396,711,966,918,796,864,119,804,207,117,289,994,496,93,797,926,949,28,138,182,786,294,368,57,844,724,970,833,580,21,875,966,74,831,226,212,37,336,1006],[1106,795,638,922,281,721,710,550,12,80,30,184,857,314,894,256,501,961,216,676,531,579,541,839,643,714,56,845,742,734,193,318,519,821,231,142,884,283,682,887,353,702,413,552,1007,298,798,850,601,1004],[1106,122,925,399,951,558,103,349,745,187,425,929,496,286,92,69,419,967,694,91,196,37,136,599,932,485,887,720,325,478,67,183,942,982,572,236,883,17,927,618,195,343,889,33,971,324,92,380,281,776],[1104,819,155,940,408,77,415,638,788,82,458,197,255,391,169,169,969,394,176,886,355,361,219,234,384,181,548,466,903,171,584,59,980,82,989,731,501,746,359,631,818,807,818,415,540,978,574,499,362,741],[1106,707,92,937,284,819,460,174,627,706,688,202,755,10,626,735,731,117,823,432,739,984,230,547,389,112,867,306,602,572,37,968,269,471,247,895,280,698,412,250,394,90,442,139,90,410,216,164,517,382]])
    
